var wpmfFoldersTreeCategoriesModule;(function($){wpmfFoldersTreeCategoriesModule={categories:[],folders_states:[],getTreeElement:function(){return $("#wpmf_foldertree_categories").find(".wpmf-folder-tree")},initModule:function(){wpmfFoldersTreeCategoriesModule.importCategories();$('<div class="wpmf-folder-tree wpmf-no-margin wpmf-no-padding"></div>').appendTo($("#wpmf_foldertree_categories"));wpmfFoldersTreeCategoriesModule.loadTreeView()},getchecked:function(folder_id,button){$("#wpmf_foldertree_categories .media_checkbox").not(button).prop("checked",false);if($(button).is(":checked")){wpmfFoldersTreeCategoriesModule.renderBreadCrumb(folder_id)}else{wpmfFoldersTreeCategoriesModule.renderBreadCrumb(0)}},importCategories:function(){var folders_ordered=[];$(wpmf.vars.wpmf_categories_order).each(function(){folders_ordered.push(wpmf.vars.wpmf_categories[this])});var folders_ordered_deep=[];var processed_ids=[];var loadChildren=function(id){if(processed_ids.indexOf(id)<0){processed_ids.push(id);for(var ij=0;ij<folders_ordered.length;ij++){if(folders_ordered[ij].parent_id===id){folders_ordered_deep.push(folders_ordered[ij]);loadChildren(folders_ordered[ij].id)}}}};loadChildren(parseInt(wpmf.vars.term_root_id));wpmfFoldersTreeCategoriesModule.categories=folders_ordered_deep},loadTreeView:function(){wpmfFoldersTreeCategoriesModule.getTreeElement().html(wpmfFoldersTreeCategoriesModule.getRendering())},getRendering:function(){var ij=0;var content="";var generateList=function generateList(){content+="<ul>";while(ij<wpmfFoldersTreeCategoriesModule.categories.length){var className="closed";if(typeof wpmfFoldersTreeCategoriesModule.categories[ij].drive_type!=="undefined"&&wpmfFoldersTreeCategoriesModule.categories[ij].drive_type!==""){className+=" hide"}content+='<li class="'+className+'" data-id="'+wpmfFoldersTreeCategoriesModule.categories[ij].id+'" >';var a_tag='<a data-id="'+wpmfFoldersTreeCategoriesModule.categories[ij].id+'">';var bgcolor="";if(typeof wpmf.vars.colors!=="undefined"&&typeof wpmf.vars.colors[wpmfFoldersTreeCategoriesModule.categories[ij].id]!=="undefined"){bgcolor="color: "+wpmf.vars.colors[wpmfFoldersTreeCategoriesModule.categories[ij].id]}else{bgcolor="color: #8f8f8f"}if(wpmfFoldersTreeCategoriesModule.categories[ij+1]&&wpmfFoldersTreeCategoriesModule.categories[ij+1].depth>wpmfFoldersTreeCategoriesModule.categories[ij].depth){content+='<a onclick="wpmfFoldersTreeCategoriesModule.toggle('+wpmfFoldersTreeCategoriesModule.categories[ij].id+')"><i class="material-icons wpmf-arrow">keyboard_arrow_down</i></a>';content+=a_tag;content+='<i class="material-icons" style="'+bgcolor+'">folder</i>'}else{content+=a_tag;content+='<i class="material-icons wpmf-no-arrow" style="'+bgcolor+'">folder</i>'}content+='<input type="checkbox" class="media_checkbox" onclick="wpmfFoldersTreeCategoriesModule.getchecked('+wpmfFoldersTreeCategoriesModule.categories[ij].id+',  this)" data-id="'+wpmfFoldersTreeCategoriesModule.categories[ij].id+'" />';if(wpmfFoldersTreeCategoriesModule.categories[ij].id===0){content+='<span onclick="wpmfFoldersTreeCategoriesModule.changeFolder(0)">'+wpmf.l18n.media_folder+"</span>"}else{content+='<span onclick="wpmfFoldersTreeCategoriesModule.changeFolder('+wpmfFoldersTreeCategoriesModule.categories[ij].id+')">'+wpmfFoldersTreeCategoriesModule.categories[ij].label+"</span>"}content+="</a>";if(wpmfFoldersTreeCategoriesModule.categories[ij+1]===undefined){for(var ik=wpmfFoldersTreeCategoriesModule.categories[ij].depth;ik>=0;ik--){content+="</li>";content+="</ul>"}return false}if(wpmfFoldersTreeCategoriesModule.categories[ij+1].depth>wpmfFoldersTreeCategoriesModule.categories[ij].depth){ij++;if(generateList()===false){return false}}else if(wpmfFoldersTreeCategoriesModule.categories[ij+1].depth<wpmfFoldersTreeCategoriesModule.categories[ij].depth){for(var ik1=wpmfFoldersTreeCategoriesModule.categories[ij].depth;ik1>wpmfFoldersTreeCategoriesModule.categories[ij+1].depth;ik1--){content+="</li>";content+="</ul>"}return true}content+="</li>";ij++}};generateList();return content},changeFolder:function(folder_id){wpmfFoldersTreeCategoriesModule.getTreeElement().find("li").removeClass("selected");wpmfFoldersTreeCategoriesModule.getTreeElement().find('li[data-id="'+folder_id+'"]').addClass("selected").parents(".wpmf-folder-tree li.closed").removeClass("closed")},renderBreadCrumb:function(folder_id){if(parseInt(folder_id)===0){$(".dir_name_categories").val("/").data("id_category",0)}else{var category=wpmf.vars.wpmf_categories[folder_id];var breadcrumb_content="";while(parseInt(category.parent_id)!==parseInt(wpmf.vars.parent)){breadcrumb_content="/"+wpmf.vars.wpmf_categories[category.id].label+breadcrumb_content;category=wpmf.vars.wpmf_categories[wpmf.vars.wpmf_categories[category.id].parent_id]}if(parseInt(category.id)!==0){breadcrumb_content=wpmf.vars.wpmf_categories[category.id].label+breadcrumb_content}breadcrumb_content="/"+breadcrumb_content+"/";$(".dir_name_categories").val(breadcrumb_content).data("id_category",folder_id)}},toggle:function(folder_id){if(wpmfFoldersTreeCategoriesModule.getTreeElement().find('li[data-id="'+folder_id+'"]').hasClass("closed")){wpmfFoldersTreeCategoriesModule.openFolder(folder_id)}else{wpmfFoldersTreeCategoriesModule.closeFolder(folder_id);$('li[data-id="'+folder_id+'"]').find("li").addClass("closed")}},openFolder:function(folder_id){wpmfFoldersTreeCategoriesModule.getTreeElement().find('li[data-id="'+folder_id+'"]').removeClass("closed");wpmfFoldersTreeCategoriesModule.folders_states[folder_id]="open"},closeFolder:function(folder_id){wpmfFoldersTreeCategoriesModule.getTreeElement().find('li[data-id="'+folder_id+'"]').addClass("closed");wpmfFoldersTreeCategoriesModule.folders_states[folder_id]="close"}};$(document).ready(function(){wpmfFoldersTreeCategoriesModule.initModule()})})(jQuery);