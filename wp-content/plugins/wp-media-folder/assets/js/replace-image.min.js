var wpmfReplaceModule;(function($){if(typeof ajaxurl==="undefined"){ajaxurl=wpmf.vars.ajaxurl}wpmfReplaceModule={doEvent:function(){$("#wpmf_upload_input_version").off("change").on("change",function(event){$("#wpmf_form_upload").submit()});$(".wpmf_submit_upload").off("click").on("click",function(event){$("#wpmf_upload_input_version").click()})},genFormReplace:function(id){$(".replace_wrap").remove();var form_replace='<div class="replace_wrap">';form_replace+='<form id="wpmf_form_upload" method="post" action="'+wpmf.vars.ajaxurl+'" enctype="multipart/form-data">';form_replace+='<input type="hidden" name="wpmf_nonce" value="'+wpmf.vars.wpmf_nonce+'">';form_replace+='<input class="hide" type="file" name="wpmf_replace_file" id="wpmf_upload_input_version"><input type="button" value="'+wpmf.l18n.replace+'" class="button-primary wpmf_submit_upload" id="submit-upload"/>';form_replace+='<input type="hidden" name="action" value="wpmf_replace_file">';form_replace+='<input type="hidden" name="post_selected" value="'+id+'">';form_replace+="</form>";form_replace+="</div>";return form_replace},replace_attachment:function(attachmentID){var $snack="";$("#wpmf_form_upload").ajaxForm({uploadProgress:function(event,position,total,wpmf_percentComplete){if(!$(".wpmf_replace_process").length){$snack=wpmfSnackbarModule.show({id:"wpmf_replace_process",content:wpmf.l18n.file_uploading,auto_close:false,is_progress:true})}},success:function(){wpmfSnackbarModule.close("wpmf_replace_process")},complete:function(xhr){$("#wpmf_progress").hide();var ob=JSON.parse(xhr.responseText);if(typeof xhr.responseText!=="undefined"){if(ob.status){$(".file-size").html("<strong>"+wpmf.l18n.filesize_label+" "+ob.size+"</strong>");if(typeof ob.dimensions!=="undefined"){$(".dimensions").html("<strong>"+wpmf.l18n.dimensions_label+" "+ob.dimensions+"</strong>")}var d=new Date;var n=d.getTime();if(typeof wpmfFoldersModule.hover_images[attachmentID]!=="undefined"){var url=wpmfFoldersModule.hover_images[attachmentID].wpmfurl;wpmfFoldersModule.hover_images[attachmentID].wpmfurl=url+"?ver="+n}wpmfSnackbarModule.show({id:"replace_file",content:wpmf.l18n.wpmf_file_replace});var $thumb=$('.attachment[data-id="'+attachmentID+'"] .thumbnail').find("img");var src_thumbnail=$thumb.attr("src");$thumb.attr("src",src_thumbnail+"?ver="+n);var $img=$(".attachment-details").find(".thumbnail img");var src_detail=$img.attr("src");$img.attr("src",src_detail+"?ver="+n);wpmfReplaceModule.forceImgReload(src_thumbnail,false,null,false);wpmfReplaceModule.forceImgReload(src_detail,false,null,false)}else{alert(ob.msg)}}}})},imgReloadBlank:function(src){var blankList=[],fullSrc=src,imgs,img,i;imgs=window.document.body.getElementsByTagName("img");for(i=imgs.length;i--;){if((img=imgs[i]).src===fullSrc){img.src="/img/1x1blank.gif";blankList.push(img)}}return blankList},imgReloadRestore:function(src,blankList,imgDim,loadError){var i,img,width=imgDim&&imgDim[0],height=imgDim&&imgDim[1];if(width)width+="px";if(height)height+="px";if(loadError){}for(i=blankList.length;i--;){(img=blankList[i]).src=src;if(width)img.style.width=width;if(height)img.style.height=height}},forceImgReload:function(src,isCrossDomain,imgDim,twostage){var blankList,step=0,iframe=window.document.createElement("iframe"),loadCallback=function(e){if(!step){if(twostage)step=1;else{step=2;blankList=wpmfReplaceModule.imgReloadBlank(src);iframe.contentWindow.location.reload(true)}}else if(step===2){wpmfReplaceModule.imgReloadRestore(src,blankList,imgDim,(e||window.event).type==="error");if(iframe.parentNode)iframe.parentNode.removeChild(iframe)}};iframe.style.display="none";window.parent.document.body.appendChild(iframe);iframe.addEventListener("load",loadCallback,false);iframe.addEventListener("error",loadCallback,false);iframe.src=isCrossDomain?"/echoimg.php?src="+encodeURIComponent(src):src;return twostage?function(proceed,dim){if(!twostage)return;twostage=false;if(proceed){imgDim=dim||imgDim;if(step===1){step=2;blankList=wpmfReplaceModule.imgReloadBlank(src);iframe.contentWindow.location.reload(true)}}else{step=3;if(iframe.contentWindow.stop)iframe.contentWindow.stop();if(iframe.parentNode)iframe.parentNode.removeChild(iframe)}}:null}};$(document).ready(function(){if(typeof wp==="undefined"){return}if(wpmf.vars.wpmf_pagenow==="upload.php"&&!wpmfFoldersModule.page_type||typeof wp.media==="undefined"){return}if(wpmfFoldersModule.page_type!=="upload-list"){var myreplaceForm=wp.media.view.AttachmentsBrowser;if(typeof myreplaceForm!=="undefined"){wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createSingle:function(){myreplaceForm.prototype.createSingle.apply(this,arguments);var sidebar=this.sidebar;var attachmentID=$(".wpmf_attachment_id").val();var form_replace=wpmfReplaceModule.genFormReplace(attachmentID);if(wpmf.vars.wpmf_pagenow!=="upload.php"){if(typeof wpmf.vars.override!=="undefined"&&parseInt(wpmf.vars.override)===1){$(".replace_wrap").remove();$(sidebar.$el).find(".attachment-info .details").append(form_replace)}}wpmfReplaceModule.doEvent();wpmfReplaceModule.replace_attachment(attachmentID)}})}if(wpmf.vars.get_plugin_active.indexOf("wp-smush.php")!==-1){if("undefined"!==typeof wp.media.view&&"undefined"!==typeof wp.media.view.Attachment.Details.TwoColumn){var wpmfAssignMediaTwoColumn=wp.media.view.Attachment.Details.TwoColumn;if(typeof wpmfAssignMediaTwoColumn!=="undefined"){wp.media.view.Attachment.Details.TwoColumn=wp.media.view.Attachment.Details.TwoColumn.extend({render:function(){wpmfAssignMediaTwoColumn.prototype.render.apply(this);$(document).ajaxComplete(function(event,xhr,settings){var data=settings.data;if(data.indexOf("smush_get_attachment_details")!==-1){var attachmentID=$(".wpmf_attachment_id").val();var form_replace=wpmfReplaceModule.genFormReplace(attachmentID);$(".replace_wrap").remove();$(".details").append(form_replace);wpmfReplaceModule.doEvent();wpmfReplaceModule.replace_attachment(attachmentID)}})}})}}}var myReplace=wp.media.view.Modal;if(typeof myReplace!=="undefined"){wp.media.view.Modal=wp.media.view.Modal.extend({open:function(){myReplace.prototype.open.apply(this,arguments);if(wpmf.vars.wpmf_pagenow==="upload.php"){if(typeof wpmf.vars.override!=="undefined"&&parseInt(wpmf.vars.override)===1){setTimeout(function(){var attachmentID=$(".wpmf_attachment_id").val();var form_replace=wpmfReplaceModule.genFormReplace(attachmentID);$(".replace_wrap").remove();$(".attachment-details .details").append(form_replace);wpmfReplaceModule.doEvent();wpmfReplaceModule.replace_attachment(attachmentID)},150)}}}})}if(wpmf.vars.wpmf_pagenow==="upload.php"){var myReplaceEditAttachments=wp.media.view.MediaFrame.EditAttachments;if(typeof myReplaceEditAttachments!=="undefined"){wp.media.view.MediaFrame.EditAttachments=wp.media.view.MediaFrame.EditAttachments.extend({previousMediaItem:function(){myReplaceEditAttachments.prototype.previousMediaItem.apply(this,arguments);if(typeof wpmf.vars.override!=="undefined"&&parseInt(wpmf.vars.override)===1){var attachmentID=$(".wpmf_attachment_id").val();var form_replace=wpmfReplaceModule.genFormReplace(attachmentID);$(".replace_wrap").remove();$(".attachment-details .details").append(form_replace);wpmfReplaceModule.doEvent();wpmfReplaceModule.replace_attachment(attachmentID)}},nextMediaItem:function(){myReplaceEditAttachments.prototype.nextMediaItem.apply(this,arguments);if(typeof wpmf.vars.override!=="undefined"&&parseInt(wpmf.vars.override)===1){var attachmentID=$(".wpmf_attachment_id").val();var form_replace=wpmfReplaceModule.genFormReplace(attachmentID);$(".replace_wrap").remove();$(".attachment-details .details").append(form_replace);wpmfReplaceModule.doEvent();wpmfReplaceModule.replace_attachment(attachmentID)}}})}}}})})(jQuery);